<div style="font-family: 'Segoe UI', sans-serif;">
      
  @if (criticalAlert()) {
    <div class="emergency-overlay">
      <div class="emergency-box">
        <div class="siren-icon"></div>
        <h1>隆EMERGENCIA DETECTADA!</h1>

        <div class="alert-details">
          <p><strong>Dispositivo:</strong> {{ criticalAlert()?.deviceId }}</p>
          
          <p style="font-size: 1.2rem; color: #d63384;">
            <strong> Ubicaci贸n:</strong> {{ criticalAlert()?.location }}
          </p>

          <p><strong>Mensaje:</strong> {{ criticalAlert()?.message }}</p>
          <p><strong>Hora:</strong> {{ criticalAlert()?.timestamp | date: 'mediumTime' }}</p>
        </div>

        <button (click)="goToDashboard()" class="btn-emergency">VER Y ATENDER AHORA</button>
      </div>
    </div>
  }

  @if (showNavbar()) {
    <nav style="background: #222; height: 60px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: relative; z-index: 10;">
      
      <a routerLink="/" style="text-decoration: none; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 8px; color: white; font-weight: bold; font-size: 1.2em;">
           StepGuard IoT
        </div>
      </a>

      @if (currentUser()) {
        <div style="display: flex; gap: 20px;">
          
          <a routerLink="/dashboard" routerLinkActive="active-link" class="nav-item">
            ┖ Monitorizaci贸n
          </a>

          <a routerLink="/devices" routerLinkActive="active-link" class="nav-item">
             Dispositivos
          </a>

          <a routerLink="/alerts" routerLinkActive="active-link" class="nav-item">
             Historial
          </a>

          @if (currentUser()?.role === 'admin' || currentUser()?.role === 'caregiver') {
            <a
              routerLink="/users"
              routerLinkActive="active-link"
              [class.nav-item-admin]="isAdmin()"
              [class.nav-item]="!isAdmin()"
            >
               {{ isAdmin() ? 'Gesti贸n Usuarios' : 'Lista Pacientes' }}
            </a>
          }
        </div>
      }

      <div style="display: flex; align-items: center; gap: 15px;">
        
        @if (currentUser()) {
          <div style="text-align: right; color: white; line-height: 1.2;">
            <div style="font-weight: bold; font-size: 0.9em;">{{ currentUser()?.fullName }}</div>
            <div style="font-size: 0.75em; opacity: 0.8; color: #ccc;">
              @switch (currentUser()?.role) {
                @case ('admin') {  Administrador }
                @case ('caregiver') {  Cuidador }
                @case ('user') {  Paciente }
              }
            </div>
          </div>
          <button
            (click)="logout()"
            style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold;"
          >
            Salir
          </button>
        } 
        
        @else {
          <a routerLink="/" style="color: white; text-decoration: none; font-weight: 500; font-size: 0.9rem; margin-right: 10px; cursor: pointer;">
            Iniciar Sesi贸n
          </a>
        }

      </div>
    </nav>
  }

  <router-outlet></router-outlet>
</div>