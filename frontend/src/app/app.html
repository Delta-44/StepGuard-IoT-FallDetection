<div style="font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; flex-direction: column;">
      
  @if (criticalAlert()) {
    <div class="critical-banner">
      <div class="banner-content">
        <span class="banner-icon">ğŸš¨</span>
        <div>
          <strong>Â¡EMERGENCIA CRÃTICA!</strong>
          <span style="margin-left: 10px; font-weight: 400; opacity: 0.9;">
            {{ criticalAlert()?.message }} en <u>{{ criticalAlert()?.location }}</u>
          </span>
        </div>
      </div>
      
      <button (click)="goToDashboard()" class="btn-banner-action">
        Ver y Atender
      </button>
    </div>
  }

  @if (showNavbar()) {
    <nav style="background: #222; height: 60px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: relative; z-index: 10;">
      <a routerLink="/" style="text-decoration: none; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 8px; color: white; font-weight: bold; font-size: 1.2em;">
          ğŸ¯ StepGuard IoT
        </div>
      </a>

      @if (currentUser()) {
        <div style="display: flex; gap: 20px;">
          <a routerLink="/dashboard" routerLinkActive="active-link" class="nav-item">ğŸ©º MonitorizaciÃ³n</a>
          <a routerLink="/devices" routerLinkActive="active-link" class="nav-item">ğŸ“± Dispositivos</a>
          <a routerLink="/alerts" routerLinkActive="active-link" class="nav-item">ğŸš¨ Historial</a>

          @if (currentUser()?.role === 'admin' || currentUser()?.role === 'caregiver') {
            <a routerLink="/users" routerLinkActive="active-link" 
               [class.nav-item-admin]="isAdmin()" [class.nav-item]="!isAdmin()">
              ğŸ‘¥ {{ isAdmin() ? 'GestiÃ³n Usuarios' : 'Lista Pacientes' }}
            </a>
          }
        </div>
      }

      <div style="display: flex; align-items: center; gap: 15px;">
        @if (currentUser()) {
          <div style="text-align: right; color: white; line-height: 1.2;">
            <div style="font-weight: bold; font-size: 0.9em;">{{ currentUser()?.fullName }}</div>
            <div style="font-size: 0.75em; opacity: 0.8; color: #ccc;">
              @switch (currentUser()?.role) {
                @case ('admin') { ğŸ”’ Administrador }
                @case ('caregiver') { ğŸ¥ Cuidador }
                @case ('user') { ğŸ‘¤ Paciente }
              }
            </div>
          </div>
          <button (click)="logout()" style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold;">
            Salir
          </button>
        } @else {
          <a routerLink="/" style="color: white; text-decoration: none; font-weight: 500; font-size: 0.9rem; margin-right: 10px; cursor: pointer;">Iniciar SesiÃ³n</a>
        }
      </div>
    </nav>
  }

  <div style="flex: 1; position: relative;">
    <router-outlet></router-outlet>
  </div>

  @if (miniAlert()) {
    <div class="toast-notification" [ngClass]="miniAlert()?.severity">
      <div class="toast-icon">
        @if (miniAlert()?.severity === 'high') { âš ï¸ }
        @else if (miniAlert()?.severity === 'medium') { ğŸ”” }
        @else { â„¹ï¸ }
      </div>
      <div class="toast-content">
        <h4>Nueva Alerta Detectada</h4>
        <p>{{ miniAlert()?.message }}</p>
        <small>ğŸ“ {{ miniAlert()?.location }}</small>
      </div>
      <div class="toast-actions">
        <button class="btn-toast-view" (click)="goToDashboardFromMini()">Atender</button>
        <button class="btn-toast-close" (click)="closeMiniAlert()">âœ•</button>
      </div>
      <div class="progress-bar"></div>
    </div>
  }

</div>