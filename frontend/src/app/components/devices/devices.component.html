<div class="min-h-screen bg-base-bg p-8">
  
  <!-- Header -->
  <div class="flex justify-between items-center mb-8 animate-fade-in">
    <div>
      <h2 class="text-3xl font-bold text-base-text flex items-center gap-3">
        <i-lucide name="radio" [size]="32"></i-lucide>
        Sensores Conectados
      </h2>
      <p class="text-gray-600 mt-2">Monitoreo en tiempo real de dispositivos IoT</p>
    </div>
    
    <button 
      (click)="loadDevices()" 
      [disabled]="isLoading()" 
      class="px-6 py-3 bg-primary text-white rounded-xl font-semibold hover:bg-primary-dark transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
    >
      @if (isLoading()) {
        <i-lucide name="clock" class="animate-spin" [size]="20"></i-lucide> Cargando...
      } @else {
        <i-lucide name="activity" [size]="20"></i-lucide> Recargar
      }
    </button>
  </div>

  <!-- Empty State -->
  @if (!isLoading() && devices().length === 0) {
    <div class="bg-white rounded-xl p-12 text-center shadow-md animate-fade-in">
      <div class="text-6xl mb-4">üì°</div>
      <p class="text-gray-500 text-lg">No se han encontrado dispositivos configurados.</p>
    </div>
  }

  <!-- Grid de Dispositivos -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    
    @for (device of devices(); track device.id) {
      <div 
        class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 overflow-hidden border-l-4 animate-fade-in"
        [ngClass]="{
          'border-operational': device.status === 'online',
          'border-emergency': device.status === 'offline',
          'border-gray-400': device.status === 'maintenance'
        }"
      >
        
        <!-- Card Header -->
        <div class="p-6 pb-4">
          <div class="flex justify-between items-start mb-4">
            <h3 class="text-xl font-bold text-base-text flex-1">{{ device.name }}</h3>
            
            <span 
              class="flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold uppercase"
              [ngClass]="{
                'bg-operational text-white': device.status === 'online',
                'bg-emergency text-white animate-pulse-emergency': device.status === 'offline',
                'bg-preventive text-white': device.status === 'maintenance'
              }"
            >
              @if (device.status === 'online') {
                <span class="w-2 h-2 bg-white rounded-full animate-glow"></span>
              }
              {{ device.status }}
            </span>
          </div>

          <!-- Info del Dispositivo -->
          <div class="space-y-2 text-sm text-gray-700">
            <div class="flex items-center gap-2">
              <span class="text-lg">üìç</span>
              <strong>Ubicaci√≥n:</strong> 
              <span class="text-gray-600">{{ device.location }}</span>
            </div>
            
            <div class="flex items-center gap-2">
              <span class="text-lg">üîã</span>
              <strong>Bater√≠a:</strong> 
              <span 
                class="font-bold"
                [ngClass]="{
                  'text-emergency': (device.batteryLevel ?? 100) < 20,
                  'text-preventive': (device.batteryLevel ?? 100) >= 20 && (device.batteryLevel ?? 100) < 50,
                  'text-operational': (device.batteryLevel ?? 100) >= 50
                }"
              >
                {{ device.batteryLevel ?? 100 }}%
              </span>
            </div>
            
            <div class="flex items-center gap-2">
              <span class="text-lg">üïí</span>
              <strong>√öltima vez:</strong> 
              <span class="text-gray-600">{{ device.lastSeen | date:'shortTime' }}</span>
            </div>
          </div>
        </div>

        <!-- Bot√≥n Admin -->
        @if (isAdmin()) {
          <div class="px-6 pb-6">
            <button 
              (click)="rebootDevice(device)" 
              class="w-full bg-emergency text-white py-3 rounded-lg font-bold hover:bg-emergency-dark transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5"
            >
              ‚ö° Reiniciar Dispositivo
            </button>
          </div>
        }
      </div>
    }
  </div>

  <!-- PANEL T√âCNICO / DEBUG -->
  <div class="animate-fade-in">
    <button 
      (click)="toggleTechnicalPanel()" 
      class="w-full px-6 py-4 bg-gray-800 text-white rounded-xl font-bold hover:bg-gray-700 transition-all duration-300 mb-4 flex items-center justify-between"
    >
      <span>üõ†Ô∏è VISTA T√âCNICA (DEBUG)</span>
      <span class="text-2xl">{{ showTechnicalPanel() ? '‚ñº' : '‚ñ∂' }}</span>
    </button>

    @if (showTechnicalPanel()) {
      <div class="bg-gray-900 text-green-400 rounded-xl p-8 font-mono text-sm animate-slide-down">
        
        <h3 class="text-red-400 text-xl font-bold mb-6 flex items-center gap-2">
          üõ†Ô∏è PANEL DE DESARROLLO
        </h3>
        
        <!-- Estados del Sistema -->
        <div class="bg-black/50 rounded-lg p-4 mb-6 space-y-3">
          <div class="flex items-center gap-3">
            <strong class="text-yellow-400">Estado Cr√≠tico:</strong> 
            <span 
              class="font-bold px-3 py-1 rounded"
              [ngClass]="criticalState() ? 'bg-emergency text-white' : 'bg-operational text-white'"
            >
              {{ criticalState() ? 'true ‚ö†Ô∏è' : 'false ‚úì' }}
            </span>
          </div>

          <div class="flex items-center gap-3">
            <strong class="text-yellow-400">Conexi√≥n:</strong> 
            <span 
              class="font-bold px-3 py-1 rounded"
              [ngClass]="connectionStatus() === 'Conectado' ? 'bg-operational text-white' : 'bg-emergency text-white'"
            >
              {{ connectionStatus() }}
              @if (connectionStatus() === 'Conectado') {
                <span class="inline-block w-2 h-2 bg-white rounded-full animate-breathe ml-2"></span>
              }
            </span>
          </div>
        </div>

        <hr class="border-gray-700 my-6">

        <!-- JSON Crudo -->
        <h4 class="text-yellow-400 font-bold mb-3 flex items-center gap-2">
          üì° Datos recibidos (JSON Crudo):
        </h4>
        <pre class="bg-black rounded-lg p-4 overflow-x-auto max-h-96 border border-gray-700 text-xs">{{ devices() | json }}</pre>

        <hr class="border-gray-700 my-6">

        <!-- Datos del Aceler√≥metro -->
        <h4 class="text-yellow-400 font-bold mb-3 flex items-center gap-2">
          üî¨ Datos del Sensor (Aceler√≥metro):
        </h4>
        <div class="space-y-3">
          @for (device of devices(); track device.id) {
            @if (device.sensorData) {
              <div 
                class="bg-black rounded-lg p-4 border-l-4 transition-all duration-300"
                [ngClass]="device.sensorData.fallDetected ? 'border-emergency animate-pulse-emergency' : 'border-operational'"
              >
                <div class="text-cyan-400 font-bold mb-3">
                  {{ device.id }} - {{ device.name }}
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div>
                    <span class="text-chart-xyAxis">‚Ä¢ AccX:</span> 
                    <span class="text-white font-bold ml-2">{{ device.sensorData.accX }} m/s¬≤</span>
                  </div>
                  <div>
                    <span class="text-chart-xyAxis">‚Ä¢ AccY:</span> 
                    <span class="text-white font-bold ml-2">{{ device.sensorData.accY }} m/s¬≤</span>
                  </div>
                  <div>
                    <span class="text-chart-zAxis">‚Ä¢ AccZ:</span> 
                    <span class="text-white font-bold ml-2">{{ device.sensorData.accZ }} m/s¬≤</span>
                  </div>
                  <div>
                    <span class="text-gray-400">‚Ä¢ Ca√≠da detectada:</span>
                    <span 
                      class="font-bold ml-2"
                      [ngClass]="device.sensorData.fallDetected ? 'text-emergency' : 'text-operational'"
                    >
                      {{ device.sensorData.fallDetected }}
                      @if (device.sensorData.fallDetected) {
                        üö®
                      }
                    </span>
                  </div>
                  @if (device.sensorData.temperature) {
                    <div>
                      <span class="text-gray-400">‚Ä¢ Temperatura:</span> 
                      <span class="text-white font-bold ml-2">{{ device.sensorData.temperature }}¬∞C</span>
                    </div>
                  }
                  @if (device.macAddress) {
                    <div class="col-span-2">
                      <span class="text-gray-400">‚Ä¢ MAC:</span> 
                      <span class="text-gray-500 ml-2">{{ device.macAddress }}</span>
                    </div>
                  }
                </div>
              </div>
            }
          }
        </div>

        <!-- Info Footer -->
        <div class="mt-6 p-4 bg-black/50 rounded-lg border border-gray-700">
          <small class="text-gray-500 block leading-relaxed">
            ‚ÑπÔ∏è Este panel muestra datos t√©cnicos para desarrollo y presentaci√≥n del proyecto IoT.
            <br>
            Los datos son recibidos del ESP32 v√≠a HTTP/MQTT y procesados por el backend.
          </small>
        </div>
      </div>
    }
  </div>
</div>