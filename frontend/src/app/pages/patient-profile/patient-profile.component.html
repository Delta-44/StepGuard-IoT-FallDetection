<div class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-gray-100">
  <!-- Profile Header with Cover -->
  <div class="relative">
    <!-- Cover Image -->
    <div
      class="h-56 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-700 relative overflow-hidden"
    >
      <div class="absolute inset-0 bg-black/20"></div>
      <div
        class="absolute inset-0"
        style="
          background-image: url('data:image/svg+xml,%3Csvg width=&quot;100&quot; height=&quot;100&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cdefs%3E%3Cpattern id=&quot;grid&quot; width=&quot;20&quot; height=&quot;20&quot; patternUnits=&quot;userSpaceOnUse&quot;%3E%3Cpath d=&quot;M 20 0 L 0 0 0 20&quot; fill=&quot;none&quot; stroke=&quot;white&quot; stroke-opacity=&quot;0.15&quot; stroke-width=&quot;1&quot;/%3E%3C/pattern%3E%3C/defs%3E%3Crect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;url(%23grid)&quot;/%3E%3C/svg%3E');
          opacity: 0.4;
        "
      ></div>
    </div>

    <!-- Botón Exportar (NIVEL SUPERIOR - VISIBILIDAD GARANTIZADA) -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; justify-content: flex-end; pointer-events: none;">
      <button
        (click)="exportData()"
        class="pointer-events-auto bg-emerald-500 text-white hover:bg-emerald-600 shadow-xl transform hover:-translate-y-1 transition-all duration-300 py-3 px-4 md:px-6 rounded-full font-bold flex items-center gap-2 border-2 border-white"
        title="Exportar mis datos"
        style="box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);"
      >
        <i-lucide name="download" [size]="20"></i-lucide>
        <span class="hidden md:inline">Exportar Datos</span>
      </button>
    </div>

    <!-- Profile Info Overlay -->
    <div class="max-w-7xl mx-auto px-4 md:px-8">
      <div class="relative -mt-24">
        <div class="bg-white rounded-3xl shadow-2xl p-5 md:p-10 border border-gray-100">
          <div class="flex flex-col md:flex-row gap-6 items-center md:items-start text-center md:text-left">
            <!-- Avatar -->
            <div class="relative group">
              <div
                class="w-32 h-32 md:w-40 md:h-40 rounded-3xl bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-600 flex items-center justify-center text-white text-5xl md:text-7xl font-black shadow-2xl ring-4 ring-white/50"
              >
                {{ currentUser()?.fullName?.charAt(0) || 'U' }}
              </div>
              <div
                class="absolute -bottom-3 -right-3 w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full border-4 border-white shadow-xl flex items-center justify-center animate-pulse"
              >
                <i-lucide name="check" [size]="24" class="text-white"></i-lucide>
              </div>
            </div>

            <!-- User Info -->
            <div class="flex-1 w-full">
              <div class="flex flex-col items-center md:items-start justify-center md:justify-start mb-4 w-full">
                <div class="flex flex-col items-center md:items-start w-full">
                  <h1 class="text-2xl md:text-4xl font-black text-gray-900 mb-2 md:mb-3 tracking-tight text-center md:text-left">
                    {{ currentUser()?.fullName }}
                  </h1>
                  <div class="flex items-center gap-2.5 flex-wrap justify-center md:justify-start">
                    <span
                      class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-bold flex items-center gap-2"
                    >
                      <i-lucide name="user" [size]="14"></i-lucide>
                      Paciente
                    </span>
                    @if (currentUser()?.edad) {
                      <span
                        class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold"
                      >
                        {{ currentUser()?.edad }} años
                      </span>
                    }
                    @if (currentUser()?.genero) {
                      <span
                        class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold"
                      >
                        {{ currentUser()?.genero }}
                      </span>
                    }
                  </div>
                </div>
              </div>

              <!-- Quick Stats -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mt-8">
                <div
                  class="text-center p-4 md:p-5 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl border-2 border-blue-200 transition-transform hover:scale-105"
                >
                  <div class="text-3xl md:text-4xl font-black text-blue-600 mb-1">
                    {{ stats.totalIncidents }}
                  </div>
                  <div
                    class="text-[10px] md:text-xs font-bold text-blue-700 uppercase tracking-wider"
                  >
                    Alertas
                  </div>
                </div>
                <div
                  class="text-center p-4 md:p-5 bg-gradient-to-br from-red-50 to-red-100 rounded-2xl border-2 border-red-200 transition-transform hover:scale-105"
                >
                  <div class="text-3xl md:text-4xl font-black text-red-600 mb-1">
                    {{ getCriticalAlerts() }}
                  </div>
                  <div
                    class="text-[10px] md:text-xs font-bold text-red-700 uppercase tracking-wider"
                  >
                    Críticas
                  </div>
                </div>
                <div
                  class="text-center p-4 md:p-5 bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl border-2 border-orange-200 transition-transform hover:scale-105"
                >
                  <div class="text-3xl md:text-4xl font-black text-orange-600 mb-1">
                    {{ stats.thisMonth }}
                  </div>
                  <div
                    class="text-[10px] md:text-xs font-bold text-orange-700 uppercase tracking-wider"
                  >
                    Este Mes
                  </div>
                </div>
                <div
                  class="text-center p-4 md:p-5 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl border-2 border-green-200 transition-transform hover:scale-105"
                >
                  <div class="text-3xl md:text-4xl font-black text-green-600 mb-1">
                    {{ stats.resolved }}
                  </div>
                  <div
                    class="text-[10px] md:text-xs font-bold text-green-700 uppercase tracking-wider"
                  >
                    Resueltas
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 md:px-8 py-6 md:py-10">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 md:gap-6">
      <!-- Left Sidebar -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Contact Information -->
        <section
          class="bg-white rounded-2xl border border-gray-200 p-5 md:p-6 shadow-lg hover:shadow-xl transition-shadow"
        >
          <div class="flex items-center gap-2.5 mb-5 pb-4 border-b-2 border-gray-100">
            <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
              <i-lucide name="mail" [size]="16" class="text-blue-600"></i-lucide>
            </div>
            <h3 class="text-base md:text-lg font-bold text-gray-900">Información de Contacto</h3>
          </div>
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <div
                class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0"
              >
                <i-lucide name="mail" [size]="18" class="text-blue-600"></i-lucide>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                  Email
                </div>
                <div class="text-sm font-semibold text-gray-900 truncate">
                  {{ currentUser()?.email }}
                </div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div
                class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center flex-shrink-0"
              >
                <i-lucide name="phone" [size]="18" class="text-green-600"></i-lucide>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                  Teléfono
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ currentUser()?.telefono || 'No especificado' }}
                </div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div
                class="w-10 h-10 rounded-lg bg-purple-50 flex items-center justify-center flex-shrink-0"
              >
                <i-lucide name="map-pin" [size]="18" class="text-purple-600"></i-lucide>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                  Dirección
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ currentUser()?.direccion || 'No especificada' }}
                </div>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <div
                class="w-10 h-10 rounded-lg bg-pink-50 flex items-center justify-center flex-shrink-0"
              >
                <i-lucide name="gift" [size]="18" class="text-pink-600"></i-lucide>
              </div>
              <div class="flex-1 min-w-0">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                  Fecha de Nacimiento
                </div>
                <div class="text-sm font-semibold text-gray-900">
                  {{
                    currentUser()?.fecha_nacimiento
                      ? (currentUser()?.fecha_nacimiento | date: 'dd/MM/yyyy')
                      : 'No especificada'
                  }}
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Device Status -->
        <section
          class="bg-white rounded-2xl border border-gray-200 p-5 md:p-6 shadow-lg hover:shadow-xl transition-shadow"
        >
          <div class="flex items-center gap-2.5 mb-5 pb-4 border-b-2 border-gray-100">
            <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
              <i-lucide name="smartphone" [size]="16" class="text-blue-600"></i-lucide>
            </div>
            <h3 class="text-base md:text-lg font-bold text-gray-900">Mi Dispositivo</h3>
          </div>
          @if (device()) {
            <div class="space-y-4">
              <div
                class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200"
              >
                <div class="flex items-center gap-3">
                  <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-lg"></div>
                  <span class="font-bold text-green-700">{{ getDeviceStatusText() }}</span>
                </div>
                <i-lucide name="activity" class="text-green-600" [size]="18"></i-lucide>
              </div>

              <div class="space-y-3">
                <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                  <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                    Nombre
                  </div>
                  <div class="text-sm font-bold text-gray-900">{{ device()?.nombre }}</div>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                  <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                    MAC Address
                  </div>
                  <div
                    class="text-xs font-mono font-bold text-gray-700 bg-gray-200 px-2 py-1 rounded inline-block"
                  >
                    {{ device()?.mac_address }}
                  </div>
                </div>
                @if (device()?.total_impactos !== undefined) {
                  <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                      Total Impactos
                    </div>
                    <div class="text-sm font-bold text-gray-900">
                      {{ device()?.total_impactos }}
                    </div>
                  </div>
                }
                @if (device()?.ultima_magnitud) {
                  <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">
                      Última Magnitud
                    </div>
                    <div class="text-sm font-bold text-gray-900">
                      {{ device()?.ultima_magnitud }} g
                    </div>
                  </div>
                }
              </div>
            </div>
          } @else {
            <div class="flex flex-col items-center justify-center py-8 text-gray-400">
              <i-lucide name="smartphone" [size]="48" class="text-gray-300 mb-3"></i-lucide>
              <p class="text-sm text-gray-500 font-medium">No hay dispositivo asignado</p>
            </div>
          }
        </section>
      </div>

      <!-- Right Content -->
      <div class="lg:col-span-1 space-y-6">
        <!-- Calendar Widget -->
        <section
          class="bg-white rounded-xl border border-gray-200 p-6 shadow-lg hover:shadow-xl transition-shadow"
        >
          <div class="flex items-center gap-3 mb-4 pb-3 border-b-2 border-gray-100">
            <div class="w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center">
              <i-lucide name="calendar-days" [size]="20" class="text-indigo-600"></i-lucide>
            </div>
            <h3 class="text-lg font-bold text-gray-900">Calendario</h3>
          </div>
          <div class="space-y-4">
            <!-- Current Date Display -->
            <div
              class="text-center p-5 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border-2 border-indigo-200"
            >
              <div class="text-sm font-bold text-indigo-600 uppercase tracking-wider mb-1">
                {{ getCurrentMonth() }}
              </div>
              <div class="text-5xl font-black text-gray-900 my-2">{{ getCurrentDay() }}</div>
              <div class="text-base font-semibold text-gray-600">{{ getCurrentYear() }}</div>
              <div class="text-sm text-gray-500 mt-2">{{ getCurrentDayName() }}</div>
            </div>

            <!-- Mini Calendar Grid -->
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
              <div class="grid grid-cols-7 gap-2 mb-2">
                <div class="text-center text-xs font-bold text-gray-600">D</div>
                <div class="text-center text-xs font-bold text-gray-600">L</div>
                <div class="text-center text-xs font-bold text-gray-600">M</div>
                <div class="text-center text-xs font-bold text-gray-600">M</div>
                <div class="text-center text-xs font-bold text-gray-600">J</div>
                <div class="text-center text-xs font-bold text-gray-600">V</div>
                <div class="text-center text-xs font-bold text-gray-600">S</div>
              </div>
              <div class="grid grid-cols-7 gap-2">
                @for (day of getCalendarDays(); track $index) {
                  <div
                    class="aspect-square min-h-[40px] flex items-center justify-center text-sm font-bold rounded-lg transition-all cursor-pointer"
                    [ngClass]="{
                      'bg-indigo-600 text-white shadow-lg scale-110': day === getCurrentDay(),
                      'text-gray-400': day === 0,
                      'text-gray-700 hover:bg-gray-200 hover:scale-105':
                        day !== getCurrentDay() && day !== 0,
                    }"
                  >
                    {{ day || '' }}
                  </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
